<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>생산계획 관리 시스템</title>
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="생산계획 관리 시스템 - 간트차트, 계획 등록, Supabase 실시간 연동">
</head>
<body>
    <div class="container">
        <!-- 헤더 영역 -->
        <header class="header">
            <h1>🏭 생산계획 관리 시스템</h1>
            <div class="connection-status-wrapper">
                <div id="connectionStatus" class="status status--info">
                    연결 상태: 확인 중...
                </div>
                <div id="syncStatus" class="sync-status">
                    <span id="lastSyncTime">마지막 저장: -</span>
                    <div id="autoSaveStatus" class="autosave-badge">자동 저장 켜짐</div>
                </div>
            </div>
        </header>

        <!-- Supabase 설정 모달 -->
        <div id="supabaseModal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3>Supabase 연결 설정</h3>
                </div>
                <div class="modal-body">
                    <p>생산계획 관리 시스템은 Supabase와 연동되어 실시간으로 데이터를 저장합니다.</p>
                    <div class="form-group">
                        <label class="form-label" for="supabaseUrl">Supabase URL</label>
                        <input type="text" id="supabaseUrl" class="form-control" value="https://kyspwjebzbozuzhgngxm.supabase.co" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="supabaseKey">Anonymous Key</label>
                        <input type="password" id="supabaseKey" class="form-control" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5c3B3amViemJvenV6aGduZ3htIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3MTk0MTUsImV4cCI6MjA2NDI5NTQxNX0.10iosLA08Q__Y7E6aJgtOWt5_AEYS783kHxSSXsf9Po" readonly>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn--secondary" id="skipSupabase">오프라인 모드</button>
                    <button type="button" class="btn btn--primary" id="connectSupabase">연결하기</button>
                </div>
            </div>
        </div>

        <!-- 삭제 확인 모달 -->
        <div id="deleteModal" class="modal">
            <div class="modal-content card">
                <div class="modal-header">
                    <h3>⚠️ 삭제 확인</h3>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">이 생산계획을 삭제하시겠습니까?</p>
                    <div class="keyboard-hint">
                        <small>키보드: Space/Enter (삭제), ESC (취소)</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn--secondary" id="cancelDelete">취소</button>
                    <button type="button" class="btn btn--error" id="confirmDelete">삭제</button>
                </div>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <!-- 계획 등록 폼 -->
            <section class="card form-section">
                <div class="card__header">
                    <h2>📝 새 생산계획 등록</h2>
                </div>
                <div class="card__body">
                    <form id="planForm" class="plan-form">
                        <div class="form-group">
                            <label class="form-label" for="customer">고객사</label>
                            <input type="text" id="customer" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="productId">제조번호</label>
                            <input type="text" id="productId" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="productName">제품명</label>
                            <input type="text" id="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="quantity">수주량 (EA)</label>
                            <input type="text" id="quantity" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="processLine">공정라인</label>
                            <select id="processLine" class="form-control" required>
                                <option value="" disabled selected>선택하세요</option>
                                <option value="PTP1">PTP1</option>
                                <option value="PTP2">PTP2</option>
                                <option value="분말스틱1">분말스틱1</option>
                                <option value="분말스틱2">분말스틱2</option>
                                <option value="분말스틱3">분말스틱3</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="startDate">시작일</label>
                                <input type="date" id="startDate" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="endDate">완료일</label>
                                <input type="date" id="endDate" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary">
                                <span id="submitText">📋 계획 등록</span>
                            </button>
                            <button type="button" id="saveButton" class="btn btn--outline">
                                <span id="saveButtonText">💾 수동 저장</span>
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- 달력 섹션 -->
            <section class="card calendar-section">
                <div class="card__header">
                    <h2>📅 생산계획 달력</h2>
                </div>
                <div class="card__body">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button type="button" class="btn btn--secondary btn--sm" id="prevMonth">◀ 이전</button>
                            <span class="current-month" id="currentMonth">2025년 6월</span>
                            <button type="button" class="btn btn--secondary btn--sm" id="nextMonth">다음 ▶</button>
                        </div>
                    </div>
                    <div class="process-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: #6c63ff;"></span>
                            <span>PTP1</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: #4CAF50;"></span>
                            <span>PTP2</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: #FF9800;"></span>
                            <span>분말스틱1</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: #E91E63;"></span>
                            <span>분말스틱2</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background-color: #9C27B0;"></span>
                            <span>분말스틱3</span>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar">
                        <!-- 달력 셀은 JS로 생성됨 -->
                    </div>
                </div>
            </section>

            <!-- 계획 목록 섹션 -->
            <section class="card plans-section">
                <div class="card__header">
                    <div class="flex justify-between items-center">
                        <h2>📋 생산계획 목록</h2>
                        <span class="plan-count" id="planCount">총 0개</span>
                    </div>
                </div>
                <div class="card__body">
                    <div id="plansList">
                        <!-- 계획 목록은 JS로 생성됨 -->
                        <div class="no-plans">
                            <p>등록된 생산계획이 없습니다.</p>
                            <p>위 폼을 통해 새 계획을 등록해보세요! 🚀</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- 툴팁 -->
    <div id="tooltip" class="tooltip"></div>

    <!-- 토스트 알림 -->
    <div id="toast" class="toast">
        <div class="toast-icon"></div>
        <div class="toast-message"></div>
        <button class="toast-close">&times;</button>
    </div>

    <!-- 스크립트 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>